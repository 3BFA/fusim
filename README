===============================================================================
Fusim - FUSion SIMulator
===============================================================================

Fusim is a program to simulate fusion genes from a reference genome. 

-------------------------------------------------------------------------
Requirements
-------------------------------------------------------------------------

- Java version 1.7 or greater
- UCSC RefFlat (GenePred table format)
    See: http://genome.ucsc.edu/FAQ/FAQformat.html#format9
- Reference genome in fasta 
- samtools (for indexing only)

-------------------------------------------------------------------------
Optional Software Requirements
-------------------------------------------------------------------------

- ART: To simulate next-generation sequencing reads from generated fusions
  genes. http://www.niehs.nih.gov/research/resources/software/biostatistics/art/

- Bowtie: align simulated reads from fusion genes. http://bowtie-bio.fs.net/

-------------------------------------------------------------------------
Setup
-------------------------------------------------------------------------

1. Download UCSC RefFlat GenePred data

  $ wget -O refFlat.txt.gz http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/refFlat.txt
  $ gunzip refFlat.txt.gz


2. Download genome reference from UCSC:

  $ wget ftp://hgdownload.cse.ucsc.edu/goldenPath/hg19/bigZips/chromFa.tar.gz

3. Extract and build one single fasta file:

  $ tar -xzf chromFa.tar.gz
  $ cat chr*.fa > hg19.fa

4. Index with samtools:

  $ samtools faidx hg19.fa


-------------------------------------------------------------------------
Basic Usage
-------------------------------------------------------------------------

- Show all available options:

    $ java -jar fusim.jar -h

- Generate Fusion genes using UCSC refFlat.txt gene model:

  $ java -jar fusim.jar --genemodel refFlat.txt --fusions 10

- Output to both FASTA and TXT format:

  # Be sure your reference genome is indexed using samtools
  $ samtools faidx hg19.fa

  $ java -jar fusim.jar \
         --genemodel=refFlat.txt \
         --fusions=10 \
         --reference=hg19.fa \
         --fasta=fusions.fasta \
         --text=fusions.txt

- Generate Fusion genes based on a background dataset (BAM file) using RPKM
  cutoff of 0.2. Note background BAM files must be indexed (*.bam.bai):

  # Be sure to index your BAM file first
  $ samtools index myreads.bam

  $ java -jar fusim.jar \
         --genemodel=refFlat.txt \
         --fusions=10 \
         --background=myreads.bam \
         --cutoff=0.2

- Generate read through genes:

  $ java -jar fusim.jar \
         --genemodel=refFlat.txt \
         --fusions=10 \
         --readthrough=10

- Only use CDS exons when generating fusion genes:

  $ java -jar fusim.jar \
         --genemodel=refFlat.txt \
         --fusions=10 \
         --cds

-------------------------------------------------------------------------
Working with GFF/GTF format
-------------------------------------------------------------------------
    
- First need to convert GFF/GTF to refFlat (genePred) format:
  $ java -jar fusim.jar --convert -i gencode.gtf -o gencodeRefFlat.txt

- Then run fusim using the converted refFlat file:
  $ java -jar fusim.jar -g gencodeRefFlat.txt -n 10

-------------------------------------------------------------------------
Simulate Illumina NGS reads using ART
-------------------------------------------------------------------------

- First build and compile ART. Sources can be downloaded from:
   http://www.niehs.nih.gov/research/resources/software/biostatistics/art/

  # Be sure the art_illumina binary is in your PATH or use --art option to
  # specify the path
  $ java -jar fusim.jar \
         --genemodel=refFlat.txt \
         --fusions=10 \
         --reference=hg19.fa \
         --fasta=fusions.fasta \
         --illumina

-------------------------------------------------------------------------
Align Illumina NGS reads using bowtie to a reference genome
-------------------------------------------------------------------------

- First ensure you have bowtie working. Installing and building bowtie indexes
  is out of the scope of this document. It is assumed you have a working bowtie
  installation and that you have the correct bowtie indexes installed for your
  genome in the "indexes" subdirectory. More information on setting up bowtie
  can be found here: http://bowtie-bio.sf.net

- Ensure you have the correct bowtie indexes for your reference genome. These
  should be installed in a subdirectory called "indexes" of your current
  working directory.

  # Be sure the bowtie binary is in your PATH or use --bowtie option to specify
  # the path
  $ java -jar fusim.jar \
         --genemodel=refFlat.txt \
         --fusions=10 \
         --reference=hg19.fa \
         --fasta=fusions.fasta \
         --illumina \
         --align \
         --index=hg19

-------------------------------------------------------------------------
Align Illumina NGS reads using bowtie and merge with a background dataset
-------------------------------------------------------------------------

- This feature allows for "injecting" simulated reads from fusion genes into an
  existing background data set. See the steps above for additional details
  simulating reads using ART and aligning using bowtie.

  $ java -jar fusim.jar \
         --genemodel=refFlat.txt \
         --fusions=10 \
         --reference=hg19.fa \
         --fasta=fusions.fasta \
         --text=fusions.key \
         --illumina \
         --align \
         --index=hg19 \
         --background=myreads.bam \
         --cutoff=0.2

-------------------------------------------------------------------------
KNOWN BUGS
-------------------------------------------------------------------------

- If a generated fusion gene is small (~145 bp) ART fails to generate reads.
  For example, ART will hang when attempting to generate paired-end reads from
  this simulated fusion gene:

>ref|NR_003207-NR_003208 fusionGene=SNORD114-14-SNORD114-15 break1=chr14:101438440-101438513 break2=chr14:101439007-101439077
TGGACCAATGATGACAACTGCCGGCGTATGAGTGTTGGGTGATGAATAATACGTGTCTAGAACTCTGAGGTCCATGGAT
CGATGATGACCACTGGTGGCGTATGAGTCATACATGATGAATATGTGTCTGGAACTCTGAGGTCCT

-------------------------------------------------------------------------
Authors
-------------------------------------------------------------------------

- Andrew E. Bruno
- Song Lui
- Jianmin Wang
- Jeffrey C. Miecznikowski
